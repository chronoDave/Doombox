# @doombox/electron

## Environments

- `production`: Load front-end from `client`. Can be generated by running `yarn build:react`.
- `development`: Load front-end from `localhost:5000`. Can be started by running `yarn start:react`.

## Scripts

- `start`: Starts Electron in `production`, with nodemon enabled.
- `start:dev`: Starts Electron in `development`, with nodemon enabled.
- `build`: Build application.
- `test`: Run tests in `production`.
- `test:dev`: Run tests in `development`.

## Code Style

### IPC

The backend expects the following properties on the IPC payload object:

  - `action`: An `ACTION` property defined in `@doombox/utils`
  - `async`: Optional. If true, sends `TYPE.IPC.INTERRUPT` on pending, success and error
  - `data`: The payload data

## Discord Integration

Doombox supports Discord RPC out of the box. To enable RPC, provide a valid `Client Id` to `discordToken` in `user-config`. You can create an `Client Id` on Discord's [Developer Portal - Application](https://discordapp.com/developers/applications) page.

Simply create an application and copy the `Client Id` on the `General Information` tab.

Doombox currently supports the following assets by default:

- `icon`: Doombox' default icon (large image key)
- `pause`: Icon when Doombox is paused (small image key)
- `play`: Icon when Doombox is playing (small image key)

Custom assets can be defined in `imageKey`. This key must be equal to a valid MP3 metadata tag (such as `genre` or `title`). Doombox will expose the value of the tag to RPC.

Example:

`imageKey: 'genre'`

Metadata genre equals to `Electro`, the key sent to RPC will be equal to `Electro`.

## Persistent Data

Data, such as config files and database files can be found in `AppData\Roaming\@doombox`

### user-config

#### general

- `forceQuit`: Force close on Mac when `true`, default `false`

#### discord

- `discordToken`: Enables Discord RPC feature when valid token is provided. See `Discord Integration` for more information, default `null`
- `imageKey`: If Discord RPC is enabled, enables custom icons for the metadata key provided, default `null`

#### keybinds

Keybinds use Electron's accelerator format, more information can be found at [Electron Documentation - Accelerator](https://electronjs.org/docs/api/accelerator)

- `NEXT`: Next track, default `'CommandOrControl+Alt+Right'`
- `PREVIOUS`: Previous track, default `'CommandOrControl+Alt+Left'`
- `PLAY`: Play track, default `'CommandOrControl+Alt+\\'`
- `PAUSE`: Pause track, default `null`
- `STOP`: Stop music, default `null`
- `VOLUME_UP`: Increase volume, default `'CommandOrControl+Alt+Up'`
- `VOLUME_DOWN`: Decrease volume, default `'CommandOrControl+Alt+Down'`
- `MUTE`: Mute, default `null`

#### palette

- `darkTheme`: Enable dark theme, default `true`

The following properties all follow the same scheme:

- `primary`
- `secondary`
- `error`
- `warning`
- `success`
- `info`
- `grey`

Default: `null`

These can be used to overwrite Doombox' default color scheme. When overwriting, the following configuration must be used:

```
{
  main: '<hexcode>',
  dark: '<hexcode>',
  light: '<hexcode>',
  contrastText: '<hexcode>'
}
```

An example (overwriting primary color scheme):

```
primary: {
  light: '#7986cb'
  main: '#3f51b5'
  dark: '#303f9f'
  contrastText: '#fff'
}
```

### system-config

#### parser

- `logging`: Enables logging of parsed files, default `true`
- `fileFormats`: Array of supported file formats, default `['mp3']`
- `glob`: Custom glob pattern. Doombox internally uses `/**/*.?(<fileFormats>))`. For more information on glab patterns, see [Glob - Glob Primer](https://www.npmjs.com/package/glob#glob-primer). When using `glob`, `fileFormats` will be overwritten, default `null`
- `parseStrict`: Throw error when invalid metadata is found on file, default `false`

### system-cache

#### player

- `volume`: Application volume cache, default `<last cache value>`
- `autoplay`: Application autoplay cache, default `<last cache value>`
- `muted`: Application muted cache, default `<last cache value>`

#### dimension

- `width`: Application width cache, default `<last cache value>`
- `height`: Application height cache, default `<last cache value>`